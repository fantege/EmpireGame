# 帝国：博弈 - 游戏界面重构 Todo（牌堆/事件牌堆/弃牌堆/事件槽/领袖名称布局）

重要：严格遵守《项目注意事项.md》，所有改动需兼容 Godot 4.4，场景文件语法必须正确。完成每个功能后更新场景结构说明.md、项目结构说明.md（不修改项目注意事项文档）。本条目仅规划与跟踪任务，不进行其他变更。

## 目标概述
实现新的游戏界面：
- 标题缩小并移动到窗口顶端；
- 不显示领袖卡列表；
- 生成“牌堆”（来自 default.json 每种2张 + policies.json），洗混并保存序列与总数，在右上角显示一个与卡牌大小、样式相同的面板，文本“牌堆”和剩余数量；
- 生成“事件牌堆”（来自 events.json），洗混并保存序列与总数，在牌堆正下方显示同样样式的面板，文本“事件牌堆”和剩余数量；
- 在事件牌堆正下方显示同样样式的“弃牌堆”面板，显示当前弃牌数量；
- 在牌堆左边、标题右侧显示四个仅有白色边框、大小与卡牌相同的矩形作为事件槽；
- 将 `/Data/cards.json` 中所有领袖卡“名称”以缩小的彩色矩形（使用各自 countryColor）显示，并将这些矩形移动到特定位置，布局为“左侧4个、上方2个、右侧4个”，保持统一间距。

## 任务拆解与执行顺序

### A. 场景布局与节点重构（main.tscn）
- [ ] 缩小 GameTitle 字体并移动到窗口顶端（例如：top=10，水平居中或靠左；font_size 调小且颜色保持）。
- [ ] 暂时隐藏或移除 CardScrollContainer 及其中的领袖卡显示。
- [ ] 在右上角新增 DeckPanel（牌堆面板），尺寸与卡牌相同（沿用当前卡牌 4:5 比例，如 160x200），应用 card_style.tres。
- [ ] 在 DeckPanel 正下方新增 EventDeckPanel（事件牌堆面板），同尺寸、同样式。
- [ ] 在 EventDeckPanel 正下方新增 DiscardPilePanel（弃牌堆面板），同尺寸、同样式。
- [ ] 在 DeckPanel 左侧、标题右侧区域新增 4 个 EventSlotPanelX（仅白色边框的矩形），尺寸与卡牌相同，边框颜色白色、无填充。
- [ ] 新增 LeaderNameContainer（或多个独立 Panel）用于显示领袖名称的缩小彩色矩形，按“左4、上2、右4”的网格布局排列，设置统一间距与对齐。

### B. 数据加载与牌堆生成（main.gd）
- [ ] 从 `/Data/default.json` 加载卡牌，按“每种2张”复制；从 `/Data/policies.json` 加载卡牌；合并为主牌堆数组 main_deck。
- [ ] 对 main_deck 洗混（使用 Array.shuffle()），保存序列与总数：main_deck_order、main_deck_count。
- [ ] 从 `/Data/events.json` 加载事件卡牌，生成 event_deck，洗混并保存序列与总数：event_deck_order、event_deck_count。
- [ ] 初始化弃牌堆 discard_pile，跟踪 discard_count（初始为0）。
- [ ] 抽象统一的数据结构（建议：{id, cardName, type/来源, meta}），保证渲染与计数更新简便。

### C. UI绑定与计数显示（main.gd）
- [ ] 为 DeckPanel 内部添加 Label，显示“牌堆”和当前剩余数量（例如：牌堆：N）。
- [ ] 为 EventDeckPanel 内部添加 Label，显示“事件牌堆”和剩余数量。
- [ ] 为 DiscardPilePanel 内部添加 Label，显示“弃牌堆”和当前弃牌数量。
- [ ] 编写 update_deck_ui() / update_event_deck_ui() / update_discard_ui() 方法，在抽牌、弃牌等操作后更新文本。

### D. 事件槽与领袖名称矩形（main.gd）
- [ ] 事件槽：生成4个空槽的可视节点，仅白色边框，无填充背景；预留放置事件卡的接口函数 place_event_to_slot(slot_index, event_card)。
- [ ] 领袖名称：从 `/Data/cards.json` 提取所有领袖的 cardName 与 countryColor，生成缩小矩形并显示文字；按“左4、上2、右4”布局定位（给出固定坐标或容器布局），设置统一间距（如 20 像素）。

### E. 场景与文档更新（仅在实现后执行）
- [ ] 更新 `场景结构说明.md`：新增 DeckPanel、EventDeckPanel、DiscardPilePanel、EventSlotPanelX、LeaderNamePanels 的节点结构与说明。
- [ ] 更新 `项目结构说明.md`：补充数据文件依赖、脚本新增函数与数据结构描述。

### F. 测试与验证
- [ ] 在 Godot 4.4 运行项目，检查界面无报错、位置与尺寸正确，文本显示正常。
- [ ] 打开预览检查布局：右上角三层（牌堆/事件牌堆/弃牌堆）、左侧四槽、顶部两名、右侧四名，标题顶端显示。

### G. 版本控制
- [ ] 提交到 develop 分支，提交信息需包含：界面重构、牌堆逻辑、事件槽与领袖名称布局。
- [ ] 推送到远程仓库，并提醒更新相关文档（遵循项目注意事项第6条）。

## 实施细节与约束
- 卡牌大小沿用现有卡牌样式与比例（4:5），建议尺寸 160×200；文本使用现有字体大小或适度缩小以适配。
- 座标与布局优先使用绝对坐标与合理间距，避免锚点导致的错位（与当前项目做法一致）。
- 数据洗混采用 `Array.shuffle()`，确保随机性；如需持久化序列，可考虑保存到用户数据文件（暂不实现）。
- 不显示领袖卡列表，仅显示缩小矩形的名称标签。
- 本 Todo 文档更新后，不进行任何其他代码或场景改动，实际实现将按本清单执行。

## 验收标准（界面与数据）
- 标题已缩小并置于窗口顶端；
- 页面不再显示领袖卡列表；
- 右上角依次显示：牌堆（含“牌堆：N”）、事件牌堆（含“事件牌堆：M”）、弃牌堆（含“弃牌堆：K”）；
- 牌堆左侧、标题右侧显示 4 个白色边框矩形事件槽；
- 领袖名称彩色矩形正确显示并按“左4、上2、右4”布局定位，间距统一；
- main_deck、event_deck 已洗混并保存序列与总数；discard_pile 计数正确更新；
- 所有改动符合 Godot 4.4 语法与项目注意事项要求。